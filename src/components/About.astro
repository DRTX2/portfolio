---
/**
 * About Component with i18n support
 * About section with highlights, expertise, and contact info
 */

import { useTranslations } from '../i18n/utils';

// Get language - default to 'en', will be updated client-side
const t = useTranslations('en');

interface Highlight {
  icon: string;
  textKey: string;
}

interface Props {
  email?: string;
  location?: string;
  resumeUrl?: string;
}

const {
  email = 'davidmanjarres2004@gmail.com',
  location = 'Ambato, Ecuador',
  resumeUrl = `${import.meta.env.BASE_URL}assets/docs/David_Oswaldo_Manjarres_Quintero_FULL.pdf`,
} = Astro.props;

// Icons remain the same across languages
const highlightIcons = [
  'fas fa-rocket',
  'fas fa-code',
  'fas fa-database',
  'fas fa-server',
  'fas fa-graduation-cap',
  'fas fa-lightbulb',
];
---

<section class="about-me" id="about-me">
  <h2>
    <span data-i18n="about.title">{t.about.title}</span>
    <span class="enfasis-title" data-i18n="about.titleHighlight">{t.about.titleHighlight}</span>
  </h2>
  <h3 class="position" aria-label="Professional Title" data-i18n="about.subtitle">
    {t.about.subtitle}
  </h3>

  <div class="about-content">
    {
      highlightIcons.map((icon, index) => (
        <div class="about-highlight">
          <i class={icon} />
          <p data-i18n={`about.highlights.${index}`} set:html={t.about.highlights[index]} />
        </div>
      ))
    }
  </div>

  <div class="expertise-areas">
    <h4 data-i18n="about.expertise">{t.about.expertise}</h4>
    <div class="expertise-tags">
      {
        t.about.expertiseTags.map((area: string, index: number) => (
          <span class="tag" data-i18n={`about.expertiseTags.${index}`}>
            {area}
          </span>
        ))
      }
    </div>
  </div>

  <div class="contact-info">
    <p>
      <span class="my-contact-email" data-i18n="about.emailLabel">{t.about.emailLabel}</span>
      <a href={`mailto:${email}`} class="my-email">{email}</a>
    </p>
    <p>
      <span class="my-contact-place" data-i18n="about.placeLabel">{t.about.placeLabel}</span>{
        location
      }
    </p>
    <button
      class="resume-button"
      data-open-cv-modal
      aria-label="View my resume"
    >
      <span class="resume" data-i18n="about.viewResume">View Resume</span>
    </button>
  </div>
</section>

<script>
  import en from '../i18n/en.json';
  import es from '../i18n/es.json';

  const translations: any = { en, es };

  function getTranslation(key: string, lang: string) {
    const keys = key.split('.');
    let value: any = translations[lang];
    for (const k of keys) {
      value = value?.[k];
      if (!value && value !== 0) break;
    }
    return value || key;
  }

  function updateAboutContent() {
    const lang = localStorage.getItem('lang') || 'en';

    // Update all elements with data-i18n attribute
    const elements = document.querySelectorAll('[data-i18n]');

    elements.forEach((el) => {
      const key = el.getAttribute('data-i18n');
      if (key) {
        const translation = getTranslation(key, lang);

        // Handle HTML content for highlights
        if (key.startsWith('about.highlights')) {
          el.innerHTML = translation;
        } else {
          el.textContent = translation;
        }
      }
    });
  }

  document.addEventListener('DOMContentLoaded', updateAboutContent);
  window.addEventListener('languagechange', updateAboutContent);
</script>
