---
/**
 * Education Component with i18n support
 * Displays educational background and certifications
 */
import { useTranslations } from '../i18n/utils';

const t = useTranslations('en');
---

<section class="education" id="education">
  <h2 data-i18n="education.title">
    {
      (() => {
        const parts = t.education.title.split('&').map((p) => p.trim());
        const firstWords = parts[0].split(' ');
        return (
          <>
            {firstWords.slice(0, -1).join(' ')}{' '}
            <span class="enfasis-title">{firstWords[firstWords.length - 1]}</span>
            {' & '}
            <span class="enfasis-title">{parts[1]}</span>
          </>
        );
      })()
    }
  </h2>
  <p data-i18n="education.quote"><i>{t.education.quote}</i></p>
  <div class="education-grid">
    <article class="university">
      <div class="institute-img">
        <img
          src={`${import.meta.env.BASE_URL}assets/img/uta.jpg`}
          alt={t.education.university.name}
        />
      </div>
      <div class="institute-description">
        <h3>
          <a href="https://www.uta.edu.ec/v4.0/" target="_blank">{t.education.university.name}</a>
        </h3>
        <p data-i18n="education.university.degree">{t.education.university.degree}</p>
        <p data-i18n="education.university.period">{t.education.university.period}</p>
        <p data-i18n="education.university.description">
          {t.education.university.description}
        </p>
      </div>
    </article>
    <article class="certificates">
      <div class="institute-img">
        <img
          src="https://img-c.udemycdn.com/course/240x135/5241962_0546.jpg"
          alt="GraphQL and Node.js"
        />
      </div>
      <div class="institute-description">
        <h3>
          <a
            href="https://www.udemy.com/certificate/UC-c05cdc6d-e2c7-45cd-baec-2c64499f6ca7/"
            target="_blank"
            data-i18n="education.certificates.graphql.title"
            >{t.education.certificates.graphql.title}</a
          >
        </h3>
        <p data-i18n="education.certificates.graphql.issuer">
          {t.education.certificates.graphql.issuer}
        </p>
        <p data-i18n="education.certificates.graphql.description">
          {t.education.certificates.graphql.description}
        </p>
      </div>
    </article>
    <article class="certificates">
      <div class="institute-img">
        <img
          src="https://img-c.udemycdn.com/course/240x135/4813286_d96b_4.jpg"
          alt="FullStack and Desktop Programming"
        />
      </div>
      <div class="institute-description">
        <h3>
          <a
            href="https://www.udemy.com/certificate/UC-4cf24303-9098-4a60-9787-adf82c453a46/"
            target="_blank"
            data-i18n="education.certificates.fullstack.title"
            >{t.education.certificates.fullstack.title}</a
          >
        </h3>
        <p data-i18n="education.certificates.fullstack.issuer">
          {t.education.certificates.fullstack.issuer}
        </p>
        <p data-i18n="education.certificates.fullstack.description">
          {t.education.certificates.fullstack.description}
        </p>
      </div>
    </article>
    <article class="full-width">
      <div class="institute-img">
        <div class="image-container">
          <img
            src="https://cdn.efset.org/efset-widget/img/v2/social-media/certificate/cefr-badge-B2.svg"
            alt="EF SET Certificate"
          />
          <img
            class="badge-logo"
            src="https://a.storyblok.com/f/246158/103x24/eb1cf2418f/efset-logo_white.svg"
            alt="EF SET Logo"
          />
        </div>
      </div>
      <div class="institute-description">
        <h3>
          <a
            href="https://cert.efset.org/vmT4Vg"
            target="_blank"
            data-i18n="education.certificates.efset.title">{t.education.certificates.efset.title}</a
          >
        </h3>
        <p data-i18n="education.certificates.efset.issuer">
          {t.education.certificates.efset.issuer}
        </p>
        <p data-i18n="education.certificates.efset.description">
          {t.education.certificates.efset.description}
        </p>
      </div>
    </article>
  </div>
</section>

<script>
  import en from '../i18n/en.json';
  import es from '../i18n/es.json';

  const translations: any = { en, es };

  function getTranslation(key: string, lang: string) {
    const keys = key.split('.');
    let value: any = translations[lang];
    for (const k of keys) {
      value = value?.[k];
      if (!value && value !== 0) break;
    }
    return value || key;
  }

  function updateEducationContent() {
    const lang = localStorage.getItem('lang') || 'en';

    // Update all elements with data-i18n attribute
    const elements = document.querySelectorAll('#education [data-i18n]');

    elements.forEach((el) => {
      const key = el.getAttribute('data-i18n');
      if (key) {
        const translation = getTranslation(key, lang);

        // Handle the title specially to keep the span formatting
        if (key === 'education.title') {
          const parts = translation.split('&').map((p) => p.trim());
          const firstWords = parts[0].split(' ');
          const prefix = firstWords.slice(0, -1).join(' ');
          const lastWord = firstWords[firstWords.length - 1];
          el.innerHTML = `${prefix} <span class="enfasis-title">${lastWord}</span> & <span class="enfasis-title">${parts[1]}</span>`;
        } else if (key === 'education.quote') {
          el.innerHTML = `<i>${translation}</i>`;
        } else {
          el.textContent = translation;
        }
      }
    });
  }

  document.addEventListener('DOMContentLoaded', updateEducationContent);
  window.addEventListener('languagechange', updateEducationContent);
</script>
